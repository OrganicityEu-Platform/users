<% include ../header %>

<ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li class="active">Edit Scenario</li>
</ol>

<div class="row">
    <% if(id) { %>
    <h1>Edit Scenario</h1>
    <% } else { %>
    <h1>Create a new Scenario</h1>
    <% } %>

    <div class="form-group">
        <label for="scenario-title">Title</label>
        <input type="email" class="form-control" id="scenario-title" placeholder="Title...">
    </div>
    <div class="form-group">
        <label for="scenario-text">Text</label>
        <textarea class="form-control" rows="12" id="scenario-text"></textarea>
    </div>
    <% if(id) { %>
    <button id="scenario-send" type="submit" class="btn btn-default">Edit</button>
    <% } else { %>
    <button id="scenario-send" type="submit" class="btn btn-default">Create</button>
    <% } %>

    <script>

        <% if(id) { %>
        $.ajax({
            type: "GET",
            url: "/scenarios/<%=id %>",
            dataType: 'json',
            success: function (e) {
                $('#scenario-title').val(e.title);
                $('#scenario-text').val(e.text);
            },
            error: function (error) {
                console.log("error", error);
            }
        });

        var ajaxType = "PUT";
        var ajaxUrl = "/scenarios/<%=id %>";
        <% } else { %>
        var ajaxType = "POST";
        var ajaxUrl = "/scenarios";
        <% } %>

        var handle = function () {
            var o = {
                title: $('#scenario-title').val(),
                text: $('#scenario-text').val(),
            }
            $.ajax({
                type: ajaxType,
                url: ajaxUrl,
                data: JSON.stringify(o),
                contentType: 'application/json',
                success: function (o) {
                    window.location = "/scenarios/" + o._id;
                },
                error: function (e) {
                    console.log("error", e);
                }
            });
        };

        $('#scenario-send').click(handle);
        $('#scenario-title').on("keypress", function (e) {
            if (e.keyCode == 13) {
                e.preventDefault();
                handle();
            }
        });
    </script>
</div>

<% include ../footer %>
